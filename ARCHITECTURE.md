# Kiáº¿n trÃºc Há»‡ thá»‘ng Payment Gateway

## ğŸ“ SÆ¡ Ä‘á»“ kiáº¿n trÃºc tá»•ng quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   React      â”‚  â”‚   Vue.js     â”‚  â”‚   Angular    â”‚         â”‚
â”‚  â”‚   App        â”‚  â”‚   App        â”‚  â”‚   App        â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                            â”‚                                     â”‚
â”‚                   HTTP/HTTPS REST APIs                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API GATEWAY LAYER                             â”‚
â”‚                            â”‚                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â”‚   Express.js Server (Port 3001)     â”‚                â”‚
â”‚         â”‚   â€¢ CORS Protection                  â”‚                â”‚
â”‚         â”‚   â€¢ Request Validation               â”‚                â”‚
â”‚         â”‚   â€¢ Error Handling                   â”‚                â”‚
â”‚         â”‚   â€¢ Logging                          â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚   VNPay Routes   â”‚  â”‚Momo Routes  â”‚  â”‚Transaction  â”‚
â”‚   â€¢ create       â”‚  â”‚â€¢ create     â”‚  â”‚Routes       â”‚
â”‚   â€¢ callback     â”‚  â”‚â€¢ callback   â”‚  â”‚â€¢ CRUD ops   â”‚
â”‚   â€¢ ipn          â”‚  â”‚â€¢ notify     â”‚  â”‚â€¢ stats      â”‚
â”‚   â€¢ query        â”‚  â”‚â€¢ query      â”‚  â”‚â€¢ filters    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ZaloPay Routes    â”‚  â”‚ViettelMoney â”‚  â”‚PayPal Routesâ”‚
â”‚â€¢ create          â”‚  â”‚Routes       â”‚  â”‚â€¢ create     â”‚
â”‚â€¢ callback        â”‚  â”‚â€¢ create     â”‚  â”‚â€¢ capture    â”‚
â”‚â€¢ query           â”‚  â”‚â€¢ callback   â”‚  â”‚â€¢ webhook    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BUSINESS LOGIC LAYER                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â”‚       Payment Utilities              â”‚                â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                â”‚
â”‚         â”‚  â”‚  VNPayUtil                     â”‚ â”‚                â”‚
â”‚         â”‚  â”‚  â€¢ signature generation        â”‚ â”‚                â”‚
â”‚         â”‚  â”‚  â€¢ signature verification      â”‚ â”‚                â”‚
â”‚         â”‚  â”‚  â€¢ payment URL creation        â”‚ â”‚                â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                â”‚
â”‚         â”‚  â”‚  MomoUtil                      â”‚ â”‚                â”‚
â”‚         â”‚  â”‚  â€¢ HMAC SHA256 signature       â”‚ â”‚                â”‚
â”‚         â”‚  â”‚  â€¢ payment request creation    â”‚ â”‚                â”‚
â”‚         â”‚  â”‚  â€¢ callback verification       â”‚ â”‚                â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                â”‚
â”‚         â”‚  â”‚  ZaloPayUtil                   â”‚ â”‚                â”‚
â”‚         â”‚  â”‚  â€¢ signature with KEY1/KEY2    â”‚ â”‚                â”‚
â”‚         â”‚  â”‚  â€¢ order creation              â”‚ â”‚                â”‚
â”‚         â”‚  â”‚  â€¢ callback verification       â”‚ â”‚                â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATA LAYER                                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â”‚   Transaction Storage               â”‚                â”‚
â”‚         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                â”‚
â”‚         â”‚   â”‚ File-based   â”‚  â”‚ MongoDB    â”‚ â”‚                â”‚
â”‚         â”‚   â”‚ (Demo)       â”‚  â”‚ (Prod)     â”‚ â”‚                â”‚
â”‚         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              EXTERNAL PAYMENT GATEWAYS                          â”‚
â”‚                            â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚           â”‚            â”‚            â”‚           â”‚          â”‚
â”‚ â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ VNPay   â”‚ â”‚  Momo   â”‚ â”‚ ZaloPay â”‚ â”‚Viettel   â”‚ â”‚ PayPal â”‚  â”‚
â”‚ â”‚ API     â”‚ â”‚  API    â”‚ â”‚  API    â”‚ â”‚Money API â”‚ â”‚  API   â”‚  â”‚
â”‚ â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   â”‚          â”‚           â”‚           â”‚            â”‚           â”‚
â”‚   â”‚ Callbacksâ”‚ Webhooks  â”‚ Callbacks â”‚ Callbacks  â”‚Webhooks  â”‚
â”‚   â”‚          â”‚           â”‚           â”‚            â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”˜
                                                            â”‚
                          Async Notifications â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Luá»“ng xá»­ lÃ½ thanh toÃ¡n chi tiáº¿t

### 1. VNPay Payment Flow

```
User Action                Backend Process              VNPay
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Click "Thanh toÃ¡n"
                          â”€â”€â”€â”€â”€â”€â–º
2. Gá»i /api/vnpay/create           
                                Táº¡o signature vá»›i HASH_SECRET
                                Táº¡o payment URL
                          â—„â”€â”€â”€â”€â”€â”€
3. Nháº­n payment URL
4. Redirect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Load form
5. Nháº­p thÃ´ng tin tháº»                               Xá»­ lÃ½ TT
6.                        â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Callback
                                Verify signature
                                Update transaction
                                Response thÃ nh cÃ´ng
7. Redirect vá» success page
```

### 2. Momo QR Payment Flow

```
User Action                Backend Process              Momo
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Click "Momo"
                          â”€â”€â”€â”€â”€â”€â–º
2. Gá»i /api/momo/create           
                                Táº¡o HMAC SHA256 signature
                                Gá»i Momo API
                          â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Create
                                Nháº­n QR code URL
3. Hiá»ƒn thá»‹ QR code       â—„â”€â”€â”€â”€â”€â”€
4. QuÃ©t QR vá»›i Momo app â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Verify
5. XÃ¡c nháº­n thanh toÃ¡n                                  Process
6.                        â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  Webhook
                                Verify signature
                                Update transaction
7. Poll/WebSocket check status
                          â—„â”€â”€â”€â”€â”€â”€
8. Nháº­n success status
```

### 3. PayPal Payment Flow

```
User Action                Backend Process              PayPal
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Click "PayPal"
                          â”€â”€â”€â”€â”€â”€â–º
2. Gá»i /api/paypal/create         
                                Get access token
                                Create order
                          â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Create
                                Nháº­n approve URL
3. Redirect               â—„â”€â”€â”€â”€â”€â”€
4. Login PayPal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Auth
5. Approve payment                                      Verify
6.                        â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  Return
                                Capture payment
                                Update transaction
7. Redirect vá» success
```

## ğŸ“¦ Component Architecture

```
backend/
â”‚
â”œâ”€â”€ server.js                 # Entry point, Express setup
â”‚   â”œâ”€â”€ Middleware:
â”‚   â”‚   â”œâ”€â”€ CORS
â”‚   â”‚   â”œâ”€â”€ Body Parser
â”‚   â”‚   â”œâ”€â”€ Error Handler
â”‚   â”‚   â””â”€â”€ Logger
â”‚   â”‚
â”‚   â””â”€â”€ Routes Registration
â”‚
â”œâ”€â”€ routes/                   # API Endpoints
â”‚   â”œâ”€â”€ vnpay.routes.js      # VNPay endpoints
â”‚   â”œâ”€â”€ momo.routes.js       # Momo endpoints
â”‚   â”œâ”€â”€ zalopay.routes.js    # ZaloPay endpoints
â”‚   â”œâ”€â”€ viettelmoney.routes.js
â”‚   â”œâ”€â”€ paypal.routes.js     # PayPal endpoints
â”‚   â””â”€â”€ transaction.routes.js # Transaction CRUD
â”‚
â”œâ”€â”€ utils/                    # Business Logic
â”‚   â”œâ”€â”€ vnpay.util.js        # VNPay helpers
â”‚   â”œâ”€â”€ momo.util.js         # Momo helpers
â”‚   â””â”€â”€ zalopay.util.js      # ZaloPay helpers
â”‚
â”œâ”€â”€ services/                 # External Services (Future)
â”‚   â”œâ”€â”€ email.service.js
â”‚   â”œâ”€â”€ notification.service.js
â”‚   â””â”€â”€ analytics.service.js
â”‚
â”œâ”€â”€ models/                   # Data Models (Future)
â”‚   â”œâ”€â”€ transaction.model.js
â”‚   â””â”€â”€ user.model.js
â”‚
â”œâ”€â”€ config/                   # Configuration
â”‚   â”œâ”€â”€ database.js
â”‚   â””â”€â”€ payment.js
â”‚
â””â”€â”€ data/                     # File-based Storage (Demo)
    â””â”€â”€ transactions.json
```

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Security Layers                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  1. Transport Layer Security                        â”‚
â”‚     â”œâ”€â”€ HTTPS/TLS 1.3                              â”‚
â”‚     â””â”€â”€ SSL Certificates                            â”‚
â”‚                                                     â”‚
â”‚  2. API Security                                    â”‚
â”‚     â”œâ”€â”€ CORS Configuration                          â”‚
â”‚     â”œâ”€â”€ Rate Limiting (Future)                      â”‚
â”‚     â””â”€â”€ Request Validation                          â”‚
â”‚                                                     â”‚
â”‚  3. Authentication & Authorization (Future)         â”‚
â”‚     â”œâ”€â”€ JWT Tokens                                  â”‚
â”‚     â”œâ”€â”€ API Keys                                    â”‚
â”‚     â””â”€â”€ OAuth 2.0                                   â”‚
â”‚                                                     â”‚
â”‚  4. Payment Security                                â”‚
â”‚     â”œâ”€â”€ Signature Verification                      â”‚
â”‚     â”‚   â”œâ”€â”€ VNPay: HMAC SHA512                     â”‚
â”‚     â”‚   â”œâ”€â”€ Momo: HMAC SHA256                      â”‚
â”‚     â”‚   â”œâ”€â”€ ZaloPay: HMAC SHA256                   â”‚
â”‚     â”‚   â””â”€â”€ PayPal: OAuth 2.0                      â”‚
â”‚     â””â”€â”€ Callback Verification                       â”‚
â”‚                                                     â”‚
â”‚  5. Data Security                                   â”‚
â”‚     â”œâ”€â”€ Environment Variables                       â”‚
â”‚     â”œâ”€â”€ Secret Management                           â”‚
â”‚     â””â”€â”€ Database Encryption                         â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš¡ Performance Optimization

```
Optimization Strategies:
â”‚
â”œâ”€â”€ Caching Layer (Future)
â”‚   â”œâ”€â”€ Redis for session/token
â”‚   â””â”€â”€ Cache payment gateway responses
â”‚
â”œâ”€â”€ Database Optimization
â”‚   â”œâ”€â”€ Indexes on frequently queried fields
â”‚   â”œâ”€â”€ Connection pooling
â”‚   â””â”€â”€ Query optimization
â”‚
â”œâ”€â”€ Load Balancing (Production)
â”‚   â”œâ”€â”€ Multiple server instances
â”‚   â”œâ”€â”€ Nginx load balancer
â”‚   â””â”€â”€ Auto-scaling
â”‚
â””â”€â”€ CDN Integration
    â””â”€â”€ Static assets delivery
```

## ğŸ”„ Deployment Architecture

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   CloudFlare â”‚
                    â”‚   CDN + DDoS â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Nginx     â”‚
                    â”‚  Load Balancerâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
   â”‚ Server 1â”‚       â”‚ Server 2  â”‚     â”‚ Server 3  â”‚
   â”‚ PM2      â”‚       â”‚ PM2       â”‚     â”‚ PM2       â”‚
   â”‚ Backend  â”‚       â”‚ Backend   â”‚     â”‚ Backend   â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Database   â”‚
                    â”‚   MongoDB    â”‚
                    â”‚   Master     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
   â”‚ Replica1â”‚       â”‚ Replica 2 â”‚     â”‚ Replica 3 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Monitoring Architecture

```
Application Metrics:
â”œâ”€â”€ PM2 Dashboard
â”‚   â”œâ”€â”€ CPU Usage
â”‚   â”œâ”€â”€ Memory Usage
â”‚   â”œâ”€â”€ Request Rate
â”‚   â””â”€â”€ Error Rate
â”‚
â”œâ”€â”€ Winston Logging
â”‚   â”œâ”€â”€ Error Logs
â”‚   â”œâ”€â”€ Access Logs
â”‚   â””â”€â”€ Payment Logs
â”‚
â”œâ”€â”€ APM Tools (Optional)
â”‚   â”œâ”€â”€ New Relic
â”‚   â”œâ”€â”€ DataDog
â”‚   â””â”€â”€ Sentry
â”‚
â””â”€â”€ Custom Analytics
    â”œâ”€â”€ Payment Success Rate
    â”œâ”€â”€ Gateway Response Times
    â””â”€â”€ Transaction Volume
```

## ğŸ¯ Scalability Plan

```
Phase 1: Current (Single Server)
    â””â”€â”€ File-based storage
    â””â”€â”€ Single Express instance

Phase 2: Horizontal Scaling
    â”œâ”€â”€ Multiple server instances
    â”œâ”€â”€ Load balancer
    â””â”€â”€ Shared MongoDB

Phase 3: Microservices
    â”œâ”€â”€ Payment Service
    â”œâ”€â”€ Transaction Service
    â”œâ”€â”€ Notification Service
    â””â”€â”€ Analytics Service

Phase 4: Cloud Native
    â”œâ”€â”€ Kubernetes orchestration
    â”œâ”€â”€ Auto-scaling pods
    â”œâ”€â”€ Service mesh
    â””â”€â”€ Distributed tracing
```

---

**Kiáº¿n trÃºc hiá»‡n táº¡i Ä‘Æ¡n giáº£n nhÆ°ng cÃ³ thá»ƒ má»Ÿ rá»™ng theo nhu cáº§u! ğŸš€**
